!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.Map=t()}}(function(){return function t(e,i,n){function s(o,h){if(!i[o]){if(!e[o]){var a="function"==typeof require&&require;if(!h&&a)return a(o,!0);if(r)return r(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var l=i[o]={exports:{}};e[o][0].call(l.exports,function(t){var i=e[o][1][t];return s(i?i:t)},l,l.exports,t,e,i,n)}return i[o].exports}for(var r="function"==typeof require&&require,o=0;o<n.length;o++)s(n[o]);return s}({1:[function(t,e){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(t){return"function"==typeof t}function s(t){return"number"==typeof t}function r(t){return"object"==typeof t&&null!==t}function o(t){return void 0===t}e.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(t){if(!s(t)||0>t||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},i.prototype.emit=function(t){var e,i,s,h,a,u;if(this._events||(this._events={}),"error"===t&&(!this._events.error||r(this._events.error)&&!this._events.error.length)){if(e=arguments[1],e instanceof Error)throw e;throw TypeError('Uncaught, unspecified "error" event.')}if(i=this._events[t],o(i))return!1;if(n(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:for(s=arguments.length,h=new Array(s-1),a=1;s>a;a++)h[a-1]=arguments[a];i.apply(this,h)}else if(r(i)){for(s=arguments.length,h=new Array(s-1),a=1;s>a;a++)h[a-1]=arguments[a];for(u=i.slice(),s=u.length,a=0;s>a;a++)u[a].apply(this,h)}return!0},i.prototype.addListener=function(t,e){var s;if(!n(e))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,n(e.listener)?e.listener:e),this._events[t]?r(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,r(this._events[t])&&!this._events[t].warned){var s;s=o(this._maxListeners)?i.defaultMaxListeners:this._maxListeners,s&&s>0&&this._events[t].length>s&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace())}return this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(t,e){function i(){this.removeListener(t,i),s||(s=!0,e.apply(this,arguments))}if(!n(e))throw TypeError("listener must be a function");var s=!1;return i.listener=e,this.on(t,i),this},i.prototype.removeListener=function(t,e){var i,s,o,h;if(!n(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(i=this._events[t],o=i.length,s=-1,i===e||n(i.listener)&&i.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(r(i)){for(h=o;h-->0;)if(i[h]===e||i[h].listener&&i[h].listener===e){s=h;break}if(0>s)return this;1===i.length?(i.length=0,delete this._events[t]):i.splice(s,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},i.prototype.removeAllListeners=function(t){var e,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(i=this._events[t],n(i))this.removeListener(t,i);else for(;i.length;)this.removeListener(t,i[i.length-1]);return delete this._events[t],this},i.prototype.listeners=function(t){var e;return e=this._events&&this._events[t]?n(this._events[t])?[this._events[t]]:this._events[t].slice():[]},i.listenerCount=function(t,e){var i;return i=t._events&&t._events[e]?n(t._events[e])?1:t._events[e].length:0}},{}],2:[function(t,e){var i=t("./mercator"),n=t("./mapUtils"),s=t("./Rect"),r=t("./Tile"),o=t("events");e.exports=function(){function t(t,e,n,s,r,h){this.provider=t||"http://{s}.tile.openstreetmap.org/{x}/{y}/{z}.png",this.domains=e||["a","b","c"],this.tileSize=i.tileSize,this._width=n||i.tileSize,this._height=s||i.tileSize,this._minZoom=Math.max(0,r),this._maxZoom=Math.max(1,h),this.latitude=0,this.longitude=0,this.zoom=0,this.tiles=[],this.keys=[],this.loadedTiles=[],this.setViewRect(0,0,this.width,this.height),this.isNode="undefined"==typeof window,this.isNode||this.createDomElements(),this.eventEmitter=new o.EventEmitter}function e(){this.container=document.createElement("div"),this._name=this.container.id="mapContainer",this.canvas=document.createElement("canvas"),this.canvas.width=this.viewRect.w,this.canvas.height=this.viewRect.h,this.ctx=this.canvas.getContext("2d"),this.container.appendChild(this.canvas),this.domElement=document.createElement("div"),this.domElement.style.position="absolute",this.domElement.style.top="0",this.domElement.style.left="0"}function h(t,e,i,n){this.viewRect=new s(t,e,i,n),null!=this.canvas&&(this.canvas.width=this.viewRect.w,this.canvas.height=this.viewRect.h)}function a(){if(!this.isNode){this.ctx.strokeStyle="rgba( 255,0,0,1 )",this.ctx.clearRect(0,0,this.viewRect.w,this.viewRect.h);for(var e=this.getViewRectCenterPixels(),i=this.domElement.getElementsByTagName("img"),n=0;n<i.length;n++){var s=i[n].tile;if(s.zoom==this.zoom){var r=this.viewRect.x+this.viewRect.w/2+(s.px-e[0]),o=this.viewRect.y+this.viewRect.h/2+(s.py-e[1]);s.img.style.position="absolute",s.img.style.left=r+"px",s.img.style.top=o+"px",s.localX=r,s.localY=o,this.ctx.drawImage(s.img,Math.round(r),Math.round(o))}}this.eventEmitter.emit(t.ON_TEXTURE_UPDATE,this.ctx)}}function u(t,e,n){var s=this.getViewRctTopLeft(),r=i.latLngToPixels(-s[0],s[1],n),o=i.latLngToPixels(t,e,n);return{x:o[0]-r[0],y:-(o[1]-r[1])}}function l(){return[this.latitude,this.longitude]}function c(){return{lat:this.latitude,lng:this.longitude}}function f(t,e,n){var s=i.latLngToPixels(-t,e,n),r=this.viewRect.w,o=this.viewRect.h,h=i.pixelsToLatLng(s[0]-r/2,s[1]-o/2,n),a=i.pixelsToLatLng(s[0]+r/2,s[1]+o/2,n);return[-h[0],h[1],-a[0],a[1]]}function v(){var t=this.viewRectToLatLng(this.latitude,this.longitude,this.zoom);return{left:t[1],top:t[0],right:t[3],bottom:t[2]}}function d(t,e,n){var r=i.latLngToPixels(-t,e,n);return new s(r[0],r[1],this.viewRect.w,this.viewRect.h)}function m(){var t=f(this.latitude,this.longitude,this.zoom,this.viewRect);return[n.map(.5,0,1,-t[0],-t[2]),n.map(.5,0,1,t[1],t[3])]}function g(){return i.latLngToPixels(-this.latitude,this.longitude,this.zoom)}function p(){var t=i.latLngToPixels(-this.latitude,this.longitude,this.zoom),e=this.viewRect.w,n=this.viewRect.h;return i.pixelsToLatLng(t[0]-e/2,t[1]-n/2,this.zoom)}function y(t){for(var e=0;e<this.tiles.length;e++)if(this.tiles[e].key==t)return this.tiles[e];return null}function w(t){return this.viewRectTiles(t).concat(this.viewRectTiles(t-1)).concat(this.viewRectTiles(t+1))}function L(t){t=t||this.zoom;for(var e=this.viewRectToLatLng(this.latitude,this.longitude,t,this.viewRect),n=i.latLonToTile(-e[0],e[1],t),s=i.latLonToTile(-e[2],e[3],t),r=0,o=0,h=n[0];h<=s[0];h++)r++;for(var a=n[1];a<=s[1];a++)o++;return[e[0],e[1],r,o]}function T(t){t=t||this.zoom;for(var e=f(this.latitude,this.longitude,t,this.viewRect),n=i.latLonToTile(-e[0],e[1],t),s=i.latLonToTile(-e[2],e[3],t),r=0,o=0,h=[],a=n[0];a<=s[0];a++){o=0;for(var u=n[1];u<=s[1];u++){for(var l=i.tileXYToQuadKey(a,u,t),c=0;c<this.loadedTiles.length;c++)if(this.loadedTiles[c].key==l){this.loadedTiles[c].viewRectPosition[0]=r,this.loadedTiles[c].viewRectPosition[1]=o,h.push(this.loadedTiles[c]);break}o++}r++}return h}function _(t,e,n,s){for(var o=this.viewRectToLatLng(t,e,n,s),h=i.latLonToTile(-o[0],o[1],n),a=i.latLonToTile(-o[2],o[3],n),u=[],l=h[0];l<=a[0];l++)for(var c=h[1];c<=a[1];c++){var f=i.tileXYToQuadKey(l,c,n);if(-1==this.keys.indexOf(f)){var v=new r(this,f);u.push(v),this.keys.push(f)}}return u}function x(t,e,i){this.latitude=t,this.longitude=e,this.zoom=i,this.load(),this.locateTiles()}function b(){var e=this.getVisibleTiles(this.latitude,this.longitude,this.zoom,this.viewRect);if(0==e.length&&0==this.tiles.length)return void this.eventEmitter.emit(t.ON_LOAD_COMPLETE,-1);for(var i=0;i<e.length;i++)e[i].eventEmitter.on(r.ON_TILE_LOADED,this.addTileToDom),e[i].load();this.tiles=this.tiles.concat(e)}function E(e){var i=e.map,n=e.img;i.domElement.appendChild(n),i.tiles.splice(i.tiles.indexOf(e),1),i.loadedTiles.push(e),i.locateTiles(!0),i.eventEmitter.emit(t.ON_TILE_LOADED,e),0==i.tiles.length&&i.eventEmitter.emit(t.ON_LOAD_COMPLETE,0)}function R(t,e,n){t=t||this.latitude,e=e||this.zoom,n=i.tileSize/256;var s=2*Math.PI*i.earthRadius;return i.earthRadius+s*Math.cos(t*RAD)/Math.pow(2,e)*n}function M(t){return t=t||this.zoom,i.resolution(t)}t.prototype={get name(){return this._name},set name(t){this._name=t,this.container.id=t},get width(){return this._width},set width(t){this._width=t,this.setViewRect(0,0,this.width,this.height)},get height(){return this._height},set height(t){this._height=t,this.setViewRect(0,0,this.width,this.height)},get minZoom(){return this._minZoom},set minZoom(t){this._minZoom=t},get maxZoom(){return this._maxZoom},set maxZoom(t){this._maxZoom=t}},t.ON_LOAD_COMPLETE=0,t.ON_TILE_LOADED=1,t.ON_TEXTURE_UPDATE=2;var O=t.prototype;return O.constructor=t,O.createDomElements=e,O.setViewRect=h,O.locateTiles=a,O.latLngToPixels=u,O.getCenter=l,O.getCenterLatLng=c,O.viewRectToLatLng=f,O.getViewPortBounds=v,O.viewRectToPixels=d,O.getViewRectCenter=m,O.getViewRectCenterPixels=g,O.getViewRctTopLeft=p,O.setView=x,O.getTileByKey=y,O.getEarthTiles=w,O.viewRectTilesDelta=L,O.viewRectTiles=T,O.getVisibleTiles=_,O.load=b,O.addTileToDom=E,O.altitude=R,O.resolution=M,t}()},{"./Rect":4,"./Tile":5,"./mapUtils":6,"./mercator":7,events:1}],3:[function(t,e){e.exports=function(t){function e(e,i){L=e||256,T=i||6378137,_=2*Math.PI*T/L,x=2*Math.PI*T/2,t.tileSize=L,t.earthRadius=T,t.initialResolution=_,t.originShift=x}function i(t,e){var i=e*x/180,n=Math.log(Math.tan((90+t)*Math.PI/360))/(Math.PI/180);return n=n*x/180,[i,n]}function n(t,e){var i=t/x*180,n=e/x*180;return n=180/Math.PI*(2*Math.atan(Math.exp(n*Math.PI/180))-Math.PI/2),[n,i]}function s(t,e,i){var n=v(i),s=t*n-x,r=e*n-x;return[s,r]}function r(t,e,i){var n=v(i),s=(t+x)/n,r=(e+x)/n;return[s,r]}function o(t,e,i){var n=r(t,e,i);return h(n[0],n[1])}function h(t,e){var i=parseInt(Math.ceil(t/parseFloat(L))-1),n=parseInt(Math.ceil(e/parseFloat(L))-1);return[i,n]}function a(t,e,i){var n=g(t,e,i);return h(n[0],n[1])}function u(t,e,i){var n=L<<i;return[t,n-e]}function l(t,e,i){var n=s(t*L,e*L,i),r=s((t+1)*L,(e+1)*L,i);return[n[0],n[1],r[0],r[1]]}function c(t,e,i){var n=l(t,e,i),s=r(n[0],n[1],i),o=r(n[2],n[3],i);return[s[0],s[1],o[0],o[1]]}function f(t,e,i){var s=l(t,e,i),r=n(s[0],s[1]),o=n(s[2],s[3]);return[r[0],r[1],o[0],o[1]]}function v(t){return _/Math.pow(2,t)}function d(t){for(var e=30;t>v(e);)if(e--,0>=e)return 0;return e}function m(t,e,i){var r=s(t,e,i);return n(r[0],r[1])}function g(t,e,n){var s=i(t,e,n);return r(s[0],s[1],n)}function p(t,e,n){var s=i(t,e);return o(s[0],s[1],n)}function y(t,e,i){for(var n="",s=i;s>0;s--){var r=0,o=1<<s-1;0!=(t&o)&&r++,0!=(e&o)&&(r++,r++),n+=r}return n}function w(t){for(var e=0,i=0,n=t.split(""),s=n.length,r=s;r>0;r--){var o=1<<r-1;switch(n[s-r]){case"0":break;case"1":e|=o;break;case"2":i|=o;break;case"3":e|=o,i|=o;break;default:return null}}return{tx:e,ty:i,zoom:s}}var L=256,T=6378137,_=2*Math.PI*T/L,x=2*Math.PI*T/2;return t.tileSize=L,t.earthRadius=T,t.initialResolution=_,t.originShift=x,t.init=e,t.latLonToMeters=i,t.metersToLatLon=n,t.pixelsToMeters=s,t.metersToPixels=r,t.metersToTile=o,t.pixelsToTile=h,t.latLonToTile=a,t.pixelsToRaster=u,t.tileMetersBounds=l,t.tilePixelsBounds=c,t.tileLatLngBounds=f,t.resolution=v,t.zoomForPixelSize=d,t.pixelsToLatLng=m,t.latLngToPixels=g,t.latLngToTile=p,t.tileXYToQuadKey=y,t.quadKeyToTileXY=w,t}({})},{}],4:[function(t,e){e.exports=function(){function t(t,e,i,n){this.x=t,this.y=e,this.w=i,this.h=n}function e(t,e){return t<this.x?!1:e<this.y?!1:t>this.x+this.w?!1:e<=this.y+this.h}function i(t,e,i,n){return this.x>=t&&this.y>=e&&this.x+this.w<=t+i&&this.y+this.h<=e+n}function n(t,e,i,n){return!(t>this.x+this.w||t+i<this.x||e>this.y+this.h||e+n<this.y)}function s(e){if(this.intersect(e.x,e.y,e.x+e.w,e.y+e.h)){var i=Math.max(this.x,e.x),n=Math.max(this.y,e.y),s=Math.min(this.x+this.w,e.x+e.w)-i,r=Math.min(this.y+this.h,e.y+e.h)-n;return new t(i,n,s,r)}return null}t.prototype={get x(){return this._x},set x(t){return this._x=t,this._x},get y(){return this._y},set y(t){return this._y=t,this._y},get w(){return this._w},set w(t){return this._w=t,this._w},get h(){return this._h},set h(t){return this._h=t,this._h}};var r=t.prototype;return r.constructor=t,r.containsPoint=e,r.isContained=i,r.intersect=n,r.intersection=s,t}()},{}],5:[function(t,e){var i=t("./Mercator"),n=t("events");e.exports=function(){function t(t,e){if(null==t)throw new Error("Tile: no map associated to Tile.");this.map=t,this.valid=!0,this.loaded=!1,this.key="",this.id=-1,this.tx=-1,this.ty=-1,this.zoom=-1,this.lat=-1,this.lng=-1,this.meterBounds=l,this.mx=-1,this.my=-1,this.pixelBounds=l,this.px=-1,this.py=-1,this.viewRectPosition=[0,0],this.latLngBounds=l,this.img=this.map.isNode?{}:new Image,this.url="",this.localX=0,this.localY=0,this.eventEmitter=new n.EventEmitter,this.quadKey=this.key=e,this.quadKey!=l&&this.initFromQuadKey(this.quadKey)}function e(t,e,n){var r=i.tileXYToQuadKey(t,e,n);s(r)}function s(t){var e=i.quadKeyToTileXY(t);if(e==l)return void(this.valid=!1);var n=i.tileLatLngBounds(this.tx+.5,this.ty+.5,this.zoom);this.lat=-n[0],this.lng=n[1],this.key=t,this.id=parseInt(t),this.tx=e.tx,this.ty=e.ty,this.zoom=e.zoom,this.meterBounds=i.tileMetersBounds(this.tx,this.ty,this.zoom),this.mx=this.meterBounds[0],this.my=this.meterBounds[1],this.pixelBounds=i.tilePixelsBounds(this.tx,this.ty,this.zoom),this.px=this.pixelBounds[0],this.py=this.pixelBounds[1],this.latLngBounds=i.tileLatLngBounds(this.tx,this.ty,this.zoom),this.latLngBounds[0]*=-1,this.latLngBounds[2]*=-1,this.url=this.getMapUrl(this.tx,this.ty,this.zoom)}function r(){var e=this;this.img.tile=this,this.img.crossOrigin="anonymous",this.img.onload=function(){e.loaded=!0,e.eventEmitter.emit(t.ON_TILE_LOADED,e)},this.map.isNode||(this.img.setAttribute("key",this.key),this.img.src=this.url,this.img.style.borderColor="red",this.img.style.borderStyle="solid",this.img.style.borderWidth="1px")}function o(t,e,i){var n=this.map.domains||["a","b","c"],s=this.map.provider;return s=s.replace(/\{x\}/,t),s=s.replace(/\{y\}/,e),s=s.replace(/\{z\}/,i),s=s.replace(/\{s\}/,n[parseInt(Math.random()*n.length)])}function h(t,e){return t>this.latLngBounds[0]?!1:e<this.latLngBounds[1]?!1:t<this.latLngBounds[2]?!1:t>this.latLngBounds[3]?!1:!0}function a(t){return this.latLngBounds[0]>=t[0]&&this.latLngBounds[1]>=t[1]&&this.latLngBounds[2]<=t[2]&&this.latLngBounds[3]<=t[3]}function u(t){return!(t[0]<this.latLngBounds[2]||t[1]>this.latLngBounds[3]||t[2]>this.latLngBounds[0]||t[3]<this.latLngBounds[1])}var l,c=t.prototype;return c.constructor=t,c.initFromTileXY=e,c.initFromQuadKey=s,c.load=r,c.getMapUrl=o,c.containsLatLng=h,c.isContained=a,c.intersect=u,t.ON_TILE_LOADED=0,t}()},{"./Mercator":3,events:1}],6:[function(t,e){e.exports.MapUtils=function(t){function e(t){return(t&-t)==t}function i(t){if(e(t))return t;for(var i=1;~~t>i;)i<<=1;return i}function n(t,e,i,n){var s=EARTH_RADIUS,r=t*h,o=i*h,a=(i-t)*h,u=(n-e)*h,l=Math.sin(a/2)*Math.sin(a/2)+Math.cos(r)*Math.cos(o)*Math.sin(u/2)*Math.sin(u/2),c=2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l));return s*c}function s(t,e,i){return e+t*(i-e)}function r(t,e,i){return(t-e)/(i-e)}function o(t,e,i,n,o){return s(r(t,e,i),n,o)}var h=Math.PI/180;return t.lerp=s,t.norm=r,t.map=o,t.isPowerOfTwo=e,t.powerTwo=i,t.latLngDistance=n,t}(e.exports)},{}],7:[function(t,e,i){arguments[4][3][0].apply(i,arguments)},{dup:3}]},{},[2])(2)});